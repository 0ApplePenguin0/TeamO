<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>회사 관리</title>
</head>
<script>
    // 하위 부서(팀) 추가
    function addSubTeam(departmentId) {
        // departmentId에 맞는 teamList 요소를 찾습니다.
        let teamList = document.getElementById(`teamList-${departmentId}`);

        // 추가될 팀 번호 계산
        let teamNum = teamList.children.length + 1;

        // 새 팀 요소 생성
        let newTeamDiv = document.createElement('li');
        newTeamDiv.setAttribute('id', `team-${departmentId}-${teamNum}`);
        newTeamDiv.innerHTML = `
        <input type="text" name="departments[${departmentId}].newTeams[${teamNum}].teamName" placeholder="새 팀명">
        <button type="button" onclick="removeTeam(${departmentId}, ${teamNum})">팀 삭제</button>
    `;

        // teamList에 새 팀 요소 추가
        teamList.appendChild(newTeamDiv);
    }

    function addSubTeam2(departmentId) {
        // departmentId에 맞는 teamList 요소를 찾습니다.
        let teamList = document.getElementById(`teamList-${departmentId}`);

        // 추가될 팀 번호 계산
        let teamNum = teamList.children.length + 1;

        // 새 팀 요소 생성
        let newTeamDiv = document.createElement('li');
        newTeamDiv.setAttribute('id', `team-${departmentId}-${teamNum}`);
        newTeamDiv.innerHTML = `
        <input type="text" name="departments[${departmentId}].newTeams[${teamNum}].teamName" placeholder="새 팀명">
        <button type="button" onclick="removeTeam(${departmentId}, ${teamNum})">팀 삭제</button>
    `;

        // teamList에 새 팀 요소 추가
        teamList.appendChild(newTeamDiv);
    }

    // 하위 부서(팀) 삭제
    function removeTeam(departmentId, teamNum) {
        let teamDiv = document.getElementById(`team-${departmentId}-${teamNum}`);
        if (teamDiv) {
            teamDiv.remove();
        } else {
            console.error(`팀 ${teamNum}를 찾을 수 없습니다.`);
        }
    }

    function removeTeam1(departmentId, index) {
        let teamDiv2 = document.getElementById(`team-${departmentId}-${index}`);
        if (teamDiv2) {
            teamDiv2.remove();
        } else {
            console.error(`팀 ${index}를 찾을 수 없습니다.`);
        }
    }

    // 부서 추가
    function addDepartment() {
        let departmentList = document.getElementById('departmentList');
        let departmentId = departmentList.children.length + 1;

        let departmentDiv = document.createElement('div');
        departmentDiv.setAttribute('class', 'department-item');
        departmentDiv.setAttribute('id', `department-${departmentId}`);
        departmentDiv.innerHTML = `
            <h3>부서 ${departmentId}</h3>
            <input type="text" name="departments[${departmentId}].departmentName" placeholder="부서명">
            <button type="button" onclick="addSubTeam(${departmentId})">하위 팀 추가</button>
            <button type="button" onclick="removeDepartment(${departmentId})">부서 삭제</button>
            <ul id="teamList-${departmentId}"></ul>
            <br>
        `;
        departmentList.appendChild(departmentDiv);
    }

    // 부서 삭제
    function removeDepartment(departmentNum) {
        let departmentDiv = document.getElementById(`department-${departmentNum}`);
        departmentDiv.remove();
    }
</script>
<body>
<form method="post" action="/saveCompany">
    <h2>부서 및 하위 팀</h2>
    <div id="departmentList">
        <!-- 기존 부서 목록과 하위 팀 표시 -->
        <div th:each="department : ${departments}">
            <h3 th:text="${department.departmentName}">부서명</h3>
            <ul id="teamList-${department.departmentId}">
                <!-- 기존 하위 팀 목록 -->
                <li th:each="team, iterStat : ${departmentTeamsMap.get(department)}"
                    th:id="'team-' + ${department.departmentId} + '-' + ${iterStat.index}">
                    <span th:text="${team.teamName}">팀명</span>
                    <button type="button" th:onclick="'removeTeam1(' + ${department.departmentId} + ', ' + ${iterStat.index} + ');'">팀 삭제</button>
                </li>
            </ul>
            <!-- 기존 부서에 하위 팀 추가 버튼 -->
            <button type="button" onclick="addSubTeam2('${department.departmentId}')">하위 팀 추가</button>
        </div>
    </div>

    <!-- 새로운 부서 추가 -->
    <button type="button" onclick="addDepartment()">부서 추가</button>

    <br><br>

    <h2>직급</h2>
    <div id="positionList">
        <div th:each="position : ${positions}">
            <div th:text="${position.positionName}">직급명</div>
        </div>
    </div>
    <button type="button" onclick="addPosition()">직급 추가</button>
    <br><br>

    <input type="submit" value="저장">
</form>
</body>
</html>