<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>현재 위치 날씨</title>
</head>
<body>
<dl>
    <dt>기온</dt>
    <dd class="temperature">--°C</dd>
    <dt>위치</dt>
    <dd class="place">--</dd>
</dl>

<script>
    const temperatureElement = document.querySelector('.temperature');
    const placeElement = document.querySelector('.place');

    let API_KEY = '';

    // Spring Boot 서버에서 API_KEY를 불러옵니다.
    fetch('/api/weather/key')
        .then(response => response.text())
        .then(key => {
            API_KEY = key;
        })
        .catch(error => {
            alert('API 키를 불러오는 중 문제가 발생했습니다.');
        });

    const getWeather = (lat, lon) => {
        if (API_KEY) {
            fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=kr`)
                .then(response => response.json())
                .then(data => {
                    temperatureElement.textContent = `${data.main.temp}°C`;
                    placeElement.textContent = data.name;
                })
                .catch(error => {
                    alert('날씨 정보를 가져오는 중 문제가 발생했습니다.');
                });
        }
    };

    const success = (position) => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        getWeather(latitude, longitude);
    };

    const fail = () => {
        alert('위치 정보를 가져올 수 없습니다.');
    };

    // 페이지 로드 시 위치 정보와 날씨 정보를 자동으로 가져옵니다.
    window.addEventListener('load', () => {
        navigator.geolocation.getCurrentPosition(success, fail);
    });
</script>

</body>
</html>