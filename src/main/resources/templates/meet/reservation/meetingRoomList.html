<!-- templates/meet/reservation/meetingRoomList.html -->
<!DOCTYPE html>
<html xmlns:th="https://thymeleaf.org/"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>회의실 목록</title>

    <!-- ========= Iconscout CSS ========== -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">

    <!-- ========= 사이드바 + 검색창 + 날씨 CSS ========== -->
    <link rel="stylesheet" th:href="@{/css/mainCss/frame.css}">

    <!-- ========= meetingRoomList CSS ========== -->
    <link rel="stylesheet" th:href="@{/css/meetReserveCss/meetingRoomList.css}">
</head>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 회의실 추가 버튼 이벤트
        const composeBtn = document.getElementById('compose-btn');
        if (composeBtn) {
            composeBtn.addEventListener('click', function() {
                window.location.href = '/reserve/meetingRoom/add';
            });
        }

        // 모든 회의실 카드에 대한 이벤트 리스너 추가
        const roomCards = document.querySelectorAll('.room-card');
        roomCards.forEach(function(card) {
            const roomId = card.getAttribute('data-room-id');
            const roomStatus = card.getAttribute('data-room-status');
            const editBtn = card.querySelector('.edit-btn');
            const deleteForm = card.querySelector('.delete-form');

            // 회의실 카드 클릭 이벤트 (상태가 AVAILABLE일 때만)
            if (roomStatus === 'AVAILABLE') {
                card.addEventListener('click', function(e) {
                    // 수정, 삭제 버튼 클릭 시 이벤트 전파 중지
                    if (e.target.closest('.room-actions')) {
                        return;
                    }
                    window.location.href = `/reserve/meetingRoom/${roomId}`;
                });
            }

            if (editBtn) {
                editBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    window.location.href = `/reserve/meetingRoom/${roomId}/edit`;
                });
            }

            if (deleteForm) {
                deleteForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    if (confirm('정말로 이 회의실을 삭제하시겠습니까?')) {
                        this.submit();
                    }
                });
            }
        });
    });
</script>
<body>
    <nav>
    <!-- 상단 로고 -->
    <div class="logo-name">
        <div class="logo-image">
            <img th:src="@{/images/mainLogo.png}" alt="">
        </div>

        <!-- 회사 이름 -->
        <!-- 사용자의 회사 이름 불러오기 -->
        <span class="logo_name">Timo</span>
    </div>

    <!-- 메뉴 -->
    <div class="menu-items">
        <ul class="nav-links">
            <!--Home-->
            <li><a th:href="@{/main/board}">
                <i class="uil uil-estate"></i>
                <span class="link-name">Home</span>
            </a></li>

            <!--회사 채팅-->
            <li>
                <a href="">
                    <i class="uil uil-comment"></i>
                    <span class="link-name">Chatroom</span>
                </a>
                <ul class="submenu">
                    <li><a th:href="@{/chat/mainChatPage}">Main Chat</a></li>
                    <li><a th:href="@{/chat/teamChatPage}">Team Chat</a></li>
                    <li><a th:href="@{/project/create}">Create Chat</a></li>
                </ul>
            </li>

            <!--Calendar-->
            <li><a th:href="@{/calendar/viewCalendar}">
                <i class="uil uil-schedule"></i>
                <span class="link-name">Calendar</span>
            </a></li>

            <!--Approval-->
            <li>
                <a href="">
                    <i class="uil uil-file-alt"></i>
                    <span class="link-name">Approval</span>
                </a>
                <ul class="submenu">
                    <li><a href="#">Receive Approval</a></li>
                    <li><a href="#">Sent Approval</a></li>
                    <li><a href="#">Write Approval</a></li>
                </ul>
            </li>

            <!--Message-->
            <li>
                <a href="">
                    <i class="uil uil-envelope"></i>
                    <span class="link-name">Message</span>
                </a>
                <ul class="submenu">
                    <li><a th:href="@{/main/board/ReceivedMessage}">Receive Message</a></li>
                    <li><a th:href="@{/main/board/SentMessage}">Sent Message</a></li>
                    <li><a th:href="@{/main/board/DeletedMessage}">Recycle Bin</a></li>
                </ul>
            </li>

            <!--Memo-->
            <li><a th:href="@{/memo/list}">
                <i class="uil uil-edit"></i>
                <span class="link-name">memo</span>
            </a></li>

            <!--Reserve-->
            <li><a href="/reserve/meetingRoom">
                <i class="uil uil-tag-alt"></i>
                <span class="link-name">Reserve</span>
            </a></li>

            <!--Attendance-->
            <li><a href="/attendance">
                <i class="uil uil-suitcase-alt"></i>
                <span class="link-name">Attendance</span>
            </a></li>

            <!--Crew-->
            <li><a href="/organization">
                <i class="uil uil-user-check"></i>
                <span class="link-name">Crew</span>
            </a></li>
        </ul>

        <!-- 메뉴 하단 버튼-->
        <ul class="logout-mode">
            <!-- 관리자 페이지 -->
            <li id="adminpage" sec:authorize="hasAnyRole('ADMIN')"><a href="#">
                <i class="uil uil-shield"></i>
                <span class="link-name">Admin</span>
            </a></li>

            <!-- 마이 페이지 -->
            <li><a href="/myPage/view">
                <i class="uil uil-user-circle"></i>
                <span class="link-name">Mypage</span>
            </a></li>

            <!-- 로그아웃 -->
            <li><a href="" id="logoutBtn">
                <i class="uil uil-sign-out-alt"></i>
                <span class="link-name">Logout</span>
            </a></li>
        </ul>
    </div>

    <!-- 로그아웃 모달 -->
    <div id="logoutModal" class="logout-modal">
        <div class="logout-content">
            <h2>로그아웃 하시겠습니까?</h2>
            <div class="logout-buttons">
                <button id="confirmLogout" class="logout-confirm">확인</button>
                <button id="cancelLogout" class="logout-cancel">취소</button>
            </div>
        </div>
    </div>
    <!-- ========= 사이드바 JS ========== -->
    <script src="/js/mainJs/sidebarJs.js"></script>

</nav>
    <!-- 메인 영역 -->
    <section class="dashboard">
        <!-- 상단 -->
        <div class="top">
            <!-- 검색 -->
            <div class="search-box">
                <i class="uil uil-search"></i>
                <input type="text" placeholder="Search here...">
            </div>
            <div class="weather">
                <i class="uil uil-sun sun"></i>
                <span class="temperature">32℃</span>
            </div>
        </div>

        <div class="meeting-container">
            <h2>회의실 목록</h2>
            <div class="meeting-btn" th:if="${role == 'ROLE_ADMIN'}">
                <button id="compose-btn" class="compose-btn">회의실 추가</button>
            </div>
        </div>

        <!-- 회의실 목록이 비어있는지 확인 -->
        <div th:if="${#lists.isEmpty(meetingRooms)}">
            <p>현재 사용 가능한 회의실이 없습니다.</p>
        </div>


        <!-- 회의실 목록 출력 -->
        <div class="meeting-rooms">
            <div class="room-card"
                 th:classappend="${room.roomStatus == 'AVAILABLE'} ? 'available' : ''"
                 th:attr="data-room-id=${room.roomId}, data-room-status=${room.roomStatus}"
                 th:each="room : ${meetingRooms}">
                <div class="room-content">
                    <div class="room-image">
                        <img th:src="@{/images/bg.jpg}" alt="회의실 이미지">
                    </div>
                    <div class="room-info">
                        <h3 th:text="${room.roomName}"></h3>
                        <p class="room-status" th:text="${room.roomStatus}"></p>
                    </div>
                </div>
                <div class="room-actions" th:if="${role == 'ROLE_ADMIN'}">
                    <button class="edit-btn">수정</button>
                    <form th:action="@{/reserve/meetingRoom/{roomId}/delete(roomId=${room.roomId})}" method="post" class="delete-form">
                        <button type="submit" class="delete-btn">삭제</button>
                    </form>
                </div>
            </div>
        </div>
    </section>
</body>
</html>
